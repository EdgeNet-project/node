---
- include_tasks: containerd-debian.yml
  when: ansible_os_family == 'Debian'

# - include_tasks: containerd-redhat.yml
  # when: ansible_os_family == 'RedHat'

# - name: Ensure containerd config directory exists
#   file:
#     path: /etc/containerd
#     state: directory
#   register: containerd_dir

# - name: Get defaults from containerd
#   command: containerd config default
#   changed_when: false
#   register: containerd_config_default
#   when: containerd_config_default_write

# - name: Write defaults to config.toml
#   copy:
#     dest: /etc/containerd/config.toml
#     content: "{{ containerd_config_default.stdout }}"
#   notify: restart containerd
#   when: containerd_config_default_write

- name: Enable containerd
  service:
    name: containerd
    state: "{{ containerd_service_state }}"
    enabled: true