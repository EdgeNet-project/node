---
- hosts: masters
  remote_user: ubuntu

  tasks:

     - name: enable scheduling pods on the control-plane node,
       shell: kubectl taint nodes --all node-role.kubernetes.io/master-
      #  shell: kubectl taint nodes --all node-role.kubernetes.io/control-plane- node-role.kubernetes.io/master-
       
     - name: deploy the EdgeNet software
       shell: kubectl apply -f https://raw.githubusercontent.com/EdgeNet-project/edgenet/main/build/yamls/kubernetes.yaml

     - name: wait for the EdgeNet software entities are up and running
       shell: kubectl get pods -n edgenet -o json
       register: kubectl_get_pods
       until: kubectl_get_pods.stdout|from_json|json_query('items[*].status.phase')|unique == ["Running"]                    